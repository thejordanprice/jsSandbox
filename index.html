<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="noindex, nofollow">
  <meta name="googlebot" content="noindex, nofollow">    
  <link rel="stylesheet" type="text/css" href="lib/css/bootstrap.min.css">
  <script type="text/javascript" src="lib/js/jquery-3.2.1.slim.min.js"></script>
  <script type="text/javascript" src="lib/js/popper.min.js"></script>
  <script type="text/javascript" src="lib/js/bootstrap.min.js"></script>
  <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script>
  <link rel="stylesheet" type="text/css" href="lib/css/sketchy.min.css">
  <link rel="stylesheet" type="text/css" href="src/style.css">
  <title>jsSandbox by thejordanprice</title>
</head>
<body>
<!-- nav bar -->
<nav class='navbar navbar-expand-lg navbar-dark bg-dark'>
  <a class='navbar-brand' href='https://thejordanprice.github.io/jsSandbox' target='_blank'><i class='fas fa-pen-square'></i> jsSandbox</a>
  <button class='navbar-toggler' type='button' data-toggle='collapse' data-target='#navbarSupportedContent' aria-controls='navbarSupportedContent' aria-expanded='false' aria-label='Toggle navigation'>
    <span class='navbar-toggler-icon'></span>
  </button>
  <div class='collapse navbar-collapse' id='navbarSupportedContent'>
    <ul class='navbar-nav mr-auto'>
      <li class='nav-item active'>
        <a class='nav-link' href='#'><i class='fas fa-home' aria-hidden='true'></i> Home</a>
      </li>
      <li class='nav-item'>
        <a class='nav-link' href='https://github.com/thejordanprice' target='_parent'><i class='fab fa-github' aria-hidden='true'></i> Github</a>
      </li>
      <li class='nav-item'>
        <a class='nav-link disabled' href='#'><i class='fas fa-user' aria-hidden='true'></i> thejordanprice</a>
      </li>
    </ul>
  </div>
</nav>
<!-- main content. -->
<div class='container'>
  <div class='text-center'>
    <small><i>Functions at their finest.</i></small>
  </div>
  <div class='form-group'>
    <label for='title'>Title &nbsp;<button class='btn btn-secondary' id='random'>Random &nbsp;<i class='fas fa-random'></i></button></label>
    <input class='form-control' type='text' id='title' placeholder='0.0.1-alpha-beta' />
  </div>
  <div class='form-group'>
    <label for='sandbox'>Function Sandbox &nbsp;<small id='exampleOne'>Example #1</small> &nbsp;<small id='exampleTwo'>Example #2</small> &nbsp;<small id='exampleThree'>Example #3</small> &nbsp;<button class='btn btn-primary' id='submit'>Run &nbsp;<i class='fas fa-rocket'></i></button> &nbsp;<button class='btn btn-info' id='trash'>Clear &nbsp;<i class='fas fa-eraser'></i></button> &nbsp;<button class='btn btn-secondary' id='save'>Save &nbsp;<i class='fas fa-save'></i></button> &nbsp;<button class='btn btn-secondary' id='load'>Load &nbsp;<i class='fas fa-cloud-download-alt'></i></button>  &nbsp;<button class='btn btn-secondary' id='destroy'>Destroy &nbsp;<i class='fas fa-trash'></i></button></label>
    <textarea class='form-control' id='sandbox' rows='8' placeholder='`use strict`;

const x = (a, b) => {
  return a * b;
};

x(4,8);'></textarea>
  </div>
  <div class='container form-group'>
    <label for='response'>Response</label>
    <pre class='form-control' id='response'>null</pre>
  </div>
  <br />
  <div class='text-center'>

  </div>
</div>
<br />
<br />
<!-- the footer -->
<footer class='footer'>
  <div class='container'>
    <div class='site-footer'>
      <p class='love'>made with <i class='fas fa-heart' aria-hidden='true'></i></p>
    </div>
  </div>
</footer>
<script>
/**
 * The JAVASCRIPT SECTION :D
 * The DOM hooks
 */
const response = document.getElementById('response');
const sandbox = document.getElementById('sandbox');
const title = document.getElementById('title');
const button = document.getElementById('submit');
const destroy = document.getElementById('destroy');
const random = document.getElementById('random');
const exampleOne = document.getElementById('exampleOne');
const exampleTwo = document.getElementById('exampleTwo');
const exampleThree = document.getElementById('exampleThree');

function GoodFetch(url, method, data) {
  return new Promise((resolve, reject)=>{
    const xhr = new XMLHttpRequest();
    let body = JSON.stringify(data);
    xhr.open('POST', url);
    xhr.setRequestHeader('content-type', 'application/json');
    xhr.send(body);
    xhr.onerror = (err)=>{
      reject({"error":err})
    }
    xhr.onload = () => {
      resolve(xhr.response);
    }
  });
}

/**
 * Our main on run function.
 */
const evaluate = () => {
  // start a timer
  let start = new Date().valueOf();
  // if both values are full continue
  if (title.value && sandbox.innerHTML) {
    // start creating a work object
    let work = {
      // just a couple things in the work object
      id: Math.random().toString(32).substr(2, 32),
      start: new Date().toLocaleString(),
      name: title.value.trim(),
      work: sandbox.value.trim(),
    };
    const evaluation = (work) => {
        // attempt the work
        let expression = work.work;
        const result = () => {
            return eval.call(null, expression);
          }
          // stop the timer
        let stop = new Date().valueOf();
        let timer = (stop - start);
        // the work was completed
        if (result) {
          let completed = {
              id: work.id,
              data: {
                name: work.name,
                time: new Date().valueOf(),
                exec: timer + 'ms',
                work: work.work,
                eval: result(),
              },
              status: true,
            }
            // work seemed to have went well.
          response.innerHTML = JSON.stringify((completed), null, 2);
        }
      }
      // running function above.
    evaluation(work);
  } else {
    // missing information.
    let errors = [];
    if (sandbox.value === '') {
      errors.push('There was no function input.');
    };
    if (title.value === '') {
      errors.push('There was no title input.');
    };
    let stop = new Date().valueOf();
    let timer = (stop - start);
    let error = {
      error: 9001,
      data: {
        execution: timer + 'ms',
        message: errors,
      },
      status: false,
    };
    response.innerHTML = JSON.stringify(error, null, 2);
  }
};

/**
 * A lame random title generator.
 */
const randomTitle = () => {
  return Math.random().toString(16).substr(2, 16) + "-v" + (Math.random() * (0.35 - (-0.35)) + (-0.35)).toFixed(2);
};

/**
 * Displaying Examples
 */
const displayExampleOne = () => {
  let string = `'use strict';

const add = (a, b) => {
  return a + b;
};

add(1, 5);`;
  return string;
};

const displayExampleTwo = () => {
  let string = `'use strict';
const multiply = (a, b) => {
  return a * b;
};
const run = () => {
  let number = multiply(7, 1);
  if (number >= 14) { return 'number was greater or equal to 14' };
  if (number <= 13) { return 'number was lower or equal to 13' };
};
run();`;
  return string;
};

const displayExampleThree = () => {
  let string = `'use strict';
const colors = [
  '#d0c2e1',
  '#bdb6d0',
  '#abaabe',
  '#989ead',
  '#86939c'
];
const select = (array, callback) => {
  let selected = array[Math.floor(Math.random() * array.length)];
  callback(selected);
};
const main = () => {
  setTimeout(() => {
    select(colors, (color) => {
      document.body.style.background = color;
      main();
    });
  }, 2500);
  return 'ultra color changing awesome stuff';
};
main();`;
  return string;
};


/**
 * Saving into the cloud, eventually then a load function.
 */
const saveFunction = () => {
  // organize our data we want to send.
  let errors = [];
  let data = {
    id: Math.random().toString(32).substr(2, 32),
    data: {
      date: new Date().valueOf(),
      name: title.value.trim(),
      work: sandbox.innerHTML.trim(),
    },
  };
  // error checking
  if (data.work === '') {
    errors.push('There was no work provided.');
  };
  if (data.name === '') {
    errors.push('There was no name provided.');
  };
  // send the data off to the cloud.
  // console.log(data);
  response.innerHTML = JSON.stringify(data, null, 2);
  /**
   * Sending the function via post.
   */
  // let url = 'https://postman-echo.com/post';
  // const url = 'https://us-central1-dev-box-175801.cloudfunctions.net/savefunc';
  const url = 'https://us-central1-dev-project-9000.cloudfunctions.net/savefunc';
  GoodFetch(url,"POST",JSON.stringify(data)).then(console.log);
};


// load example 1 code into sandbox.
exampleOne.addEventListener('click', () => {
  sandbox.innerHTML = displayExampleOne();
  return false;
});

// load example 2 code into sandbox.
exampleTwo.addEventListener('click', () => {
  sandbox.innerHTML = displayExampleTwo();
  return false;
});

// load example 3 code into sandbox.
exampleThree.addEventListener('click', () => {
  sandbox.innerHTML = displayExampleThree();
  return false;
});

// add trash for just sandbox
trash.addEventListener('click', () => {
	sandbox.innerHTML = '';
  return false;
});

// initiate random title generator.
random.addEventListener('click', () => {
  title.value = randomTitle();
  return false;
});

// to clear out said data easily
destroy.addEventListener('click', () => {
  response.innerHTML = 'destroyed';
  sandbox.value = '';
  title.value = '';
  return false;
});

// to submit and evaluate
submit.addEventListener('click', () => {
  evaluate();
  return false;
});

// save to google cloud db
save.addEventListener('click', () => {
  saveFunction();
  return false;
});
</script>
</body>
</html>

